/*
 * Copyright (c) 2020 The ZMK Contributors
 *
 * SPDX-License-Identifier: MIT
 */

#include <dt-bindings/zmk/matrix_transform.h>

/*
PIN MAPPING EXPLANATION:
The nice!nano uses an nRF52840 with two GPIO ports: P0 and P1.
- P0.XX pins: Use the number directly (e.g., 9 for P0.09)
- P1.XX pins: Use 32 + the port number (e.g., 32 + 11 = 43 for P1.11)

Your pin assignments:
Rows:    P0.09(9), P0.10(10), P1.11(43), P1.13(45)
Columns: P1.06(38), P1.04(36), P0.11(11), P1.00(32), P0.24(24), P0.22(22), P0.20(20)
*/

/ {
	chosen {
		zmk,kscan = &kscan0;
		zmk,matrix_transform = &default_transform;
		zmk,split = &split;
	};

	split: split {
		compatible = "zmk,split-bt";
		label = "SPLIT";
	};

	default_transform: keymap_transform_0 {
		compatible = "zmk,matrix-transform";
		columns = <7>;
		rows = <4>;
		map = <
/* ╔════════════════════════╦════════════════════════╗
   ║ LEFT SIDE              ║ RIGHT SIDE             ║
   ║ Row 0 (top):           ║ Row 0 (top):           ║
   ║ 0   1   2   3   4   5  ║ 35  36  37  38  39  40 ║
   ║                        ║                        ║
   ║ Row 1 (home):          ║ Row 1 (home):          ║
   ║ 6   7   8   9   10  11 12║ 13  14  15  16  17  18 19║
   ║                        ║                        ║
   ║ Row 2 (bottom):        ║ Row 2 (bottom):        ║
   ║ 20  21  22  23  24  25 26║ 27  28  29  30  31  32 33║
   ║                        ║                        ║
   ║ Row 3 (thumb):         ║ Row 3 (thumb):         ║
   ║         10  11  12     ║ 13  14  15             ║
   ╚════════════════════════╩════════════════════════╝

   EXPLANATION OF KEYCODES:
   - Left side keys 0-34 (but we only use up to 26 as the aux column is at position 12)
   - Right side keys 35-52 (mirrored layout)
   
   Note: Row 3 (thumbs) uses keys from rows 1 and 2 positions (10, 11, 12 on left / 13, 14, 15 on right)
   This is called "matrix reuse" - the same physical keys serve double-duty in the transform
*/

/* Physical Layout (what you see):
   LEFT HALF:
   Row 0:  C1  C2  C3  C4  C5  C6
   Row 1:  C1  C2  C3  C4  C5  C6  AUX
   Row 2:  C1  C2  C3  C4  C5  C6  AUX
   Row 3:          C5  C6  AUX
   
   RIGHT HALF:
   Row 0:  C1  C2  C3  C4  C5  C6
   Row 1:  AUX C6  C5  C4  C3  C2  C1
   Row 2:  AUX C6  C5  C4  C3  C2  C1
   Row 3:  AUX C6  C5
*/

			RC(0,0) RC(0,1) RC(0,2) RC(0,3) RC(0,4) RC(0,5)                 RC(0,5) RC(0,4) RC(0,3) RC(0,2) RC(0,1) RC(0,0)
			RC(1,0) RC(1,1) RC(1,2) RC(1,3) RC(1,4) RC(1,5) RC(1,6)     RC(1,6) RC(1,5) RC(1,4) RC(1,3) RC(1,2) RC(1,1) RC(1,0)
			RC(2,0) RC(2,1) RC(2,2) RC(2,3) RC(2,4) RC(2,5) RC(2,6)     RC(2,6) RC(2,5) RC(2,4) RC(2,3) RC(2,2) RC(2,1) RC(2,0)
					RC(3,4) RC(3,5) RC(3,6)                 RC(3,6) RC(3,5) RC(3,4)
		>;
	};

	kscan0: kscan {
		compatible = "zmk,kscan-gpio-matrix";
		label = "KSCAN";
		/* 
		WHAT THIS DOES:
		- Defines how ZMK scans the keyboard matrix (which pins are rows/cols)
		- GPIO matrix scanning: outputs to row pins, reads from column pins
		- debounce-press/release: filtering for key bouncing (in milliseconds)
		- debounce-type: "eager" = respond immediately to key press
		*/

		diode-direction = "col2row";
		/* 
		DIODE EXPLANATION:
		- "col2row" means your matrix has diodes pointing FROM rows TO columns
		- This is the standard configuration for preventing ghosting
		- The diode blocks reverse current, ensuring accurate multi-key detection
		*/

		row-gpios
			= <&gpio0 9 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>   /* P0.09 - top row */
			, <&gpio0 10 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>  /* P0.10 - home row */
			, <&gpio1 11 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>  /* P1.11 - bottom row */
			, <&gpio1 13 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>  /* P1.13 - thumb row */
			;

		col-gpios
			= <&gpio1 6 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>   /* P1.06 - outer column */
			, <&gpio1 4 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>   /* P1.04 - pinkie column */
			, <&gpio0 11 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>  /* P0.11 - ring column */
			, <&gpio1 0 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>   /* P1.00 - middle column */
			, <&gpio0 24 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>  /* P0.24 - index column */
			, <&gpio0 22 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>  /* P0.22 - inner column */
			, <&gpio0 20 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>  /* P0.20 - aux column */
			;
	};
};
