/*
 * Copyright (c) 2020 The ZMK Contributors
 *
 * SPDX-License-Identifier: MIT
 */

#include <dt-bindings/zmk/matrix_transform.h>

/ {
	chosen {
		zmk,kscan = &kscan0;
		zmk,matrix_transform = &default_transform;
	};

	default_transform: keymap_transform_0 {
		compatible = "zmk,matrix-transform";
		columns = <7>;
		rows = <4>;
		map = <
/* ╔════════════════════════╦════════════════════════╗
   ║ LEFT SIDE              ║ RIGHT SIDE             ║
   ║ Row 0 (top):           ║ Row 0 (top):           ║
   ║ 0   1   2   3   4   5  ║ 35  36  37  38  39  40 ║
   ║                        ║                        ║
   ║ Row 1 (home):          ║ Row 1 (home):          ║
   ║ 6   7   8   9   10  11 12║ 13  14  15  16  17  18 19║
   ║                        ║                        ║
   ║ Row 2 (bottom):        ║ Row 2 (bottom):        ║
   ║ 20  21  22  23  24  25 26║ 27  28  29  30  31  32 33║
   ║                        ║                        ║
   ║ Row 3 (thumb):         ║ Row 3 (thumb):         ║
   ║         10  11  12     ║ 13  14  15             ║
   ╚════════════════════════╩════════════════════════╝

   EXPLANATION OF KEYCODES:
   - Left side keys 0-34 (but we only use up to 26 as the aux column is at position 12)
   - Right side keys 35-52 (mirrored layout)
   
   Note: Row 3 (thumbs) uses keys from rows 1 and 2 positions (10, 11, 12 on left / 13, 14, 15 on right)
   This is called "matrix reuse" - the same physical keys serve double-duty in the transform
*/

/* Physical Layout (what you see):
   LEFT HALF:
   Row 0:  C1  C2  C3  C4  C5  C6
   Row 1:  C1  C2  C3  C4  C5  C6  AUX
   Row 2:  C1  C2  C3  C4  C5  C6  AUX
   Row 3:          C5  C6  AUX
   
   RIGHT HALF:
   Row 0:  C1  C2  C3  C4  C5  C6
   Row 1:  AUX C6  C5  C4  C3  C2  C1
   Row 2:  AUX C6  C5  C4  C3  C2  C1
   Row 3:  AUX C6  C5
*/

			RC(0,0) RC(0,1) RC(0,2) RC(0,3) RC(0,4) RC(0,5)                 RC(0,5) RC(0,4) RC(0,3) RC(0,2) RC(0,1) RC(0,0)
			RC(1,0) RC(1,1) RC(1,2) RC(1,3) RC(1,4) RC(1,5) RC(1,6)     RC(1,6) RC(1,5) RC(1,4) RC(1,3) RC(1,2) RC(1,1) RC(1,0)
			RC(2,0) RC(2,1) RC(2,2) RC(2,3) RC(2,4) RC(2,5) RC(2,6)     RC(2,6) RC(2,5) RC(2,4) RC(2,3) RC(2,2) RC(2,1) RC(2,0)
					RC(3,4) RC(3,5) RC(3,6)                 RC(3,6) RC(3,5) RC(3,4)
		>;
	};

	kscan0: kscan {
		compatible = "zmk,kscan-gpio-matrix";
		label = "KSCAN";
		/* 
		WHAT THIS DOES:
		- Defines how ZMK scans the keyboard matrix (which pins are rows/cols)
		- GPIO matrix scanning: outputs to row pins, reads from column pins
		- debounce-press/release: filtering for key bouncing (in milliseconds)
		- debounce-type: "eager" = respond immediately to key press
		*/

		diode-direction = "col2row";
		/* 
		DIODE EXPLANATION:
		- "col2row" means your matrix has diodes pointing FROM rows TO columns
		- This is the standard configuration for preventing ghosting
		- The diode blocks reverse current, ensuring accurate multi-key detection
		*/

		row-gpios
			= <&pro_micro 9 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>  /* P009 - top row */
			, <&pro_micro 10 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)> /* P010 - home row */
			, <&pro_micro 111 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)> /* P111 - bottom row (note: 111 = P1.11) */
			, <&pro_micro 113 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)> /* P113 - thumb row (note: 113 = P1.13) */
			;

		col-gpios
			= <&pro_micro 106 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)> /* P106 - outer column */
			, <&pro_micro 104 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)> /* P104 - pinkie column */
			, <&pro_micro 11 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>  /* P011 - ring column */
			, <&pro_micro 100 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)> /* P100 - middle column */
			, <&pro_micro 24 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>  /* P024 - index column */
			, <&pro_micro 22 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>  /* P022 - inner column */
			, <&pro_micro 20 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>  /* P020 - aux column */
			;
	};
};
